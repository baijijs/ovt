#!/usr/bin/env node

'use strict';

const Benchmark = require('benchmark');
const Ovt = require('../');

const Joi = require('joi');

// var heapdump = require('heapdump');
//
// heapdump.writeSnapshot('./' + Date.now() + '.heapsnapshot');



var suite = new Benchmark.Suite;

const ovtSchema = Ovt.object.keys({
  name: Ovt.string.required.default('Felix Liu'),
  email: Ovt.string.required,
  hobbies: Ovt.array.items(
    Ovt.string.required,
    Ovt.string.required,
    Ovt.string
  )
});

// var profiler = require('v8-profiler');
// profiler.startProfiling('1', true);

const joiSchema = Joi.object().keys({
  name: Joi.string().required().default('Felix Liu'),
  email: Joi.string().required(),
  hobbies: Joi.array().items(
    Joi.string().required(),
    Joi.string().required(),
    Joi.string()
  )
});

// add tests
suite
// .add('Ovt#schema', function() {
//   Ovt.object.keys({
//     name: Ovt.string.required.default('Felix Liu'),
//     email: Ovt.string.required,
//     hobbies: Ovt.array.items(
//       Ovt.string.required,
//       Ovt.string.required,
//       Ovt.string
//     )
//   });
// })
// .add('Chai#expect', function() {
//   Chai.expect(true).to.be.true;
// })
// .add('Joi#schema', function() {
//   Joi.object().keys({
//     name: Joi.string().required().default('Felix Liu'),
//     email: Joi.string().required(),
//     hobbies: Joi.array().items(
//       Joi.string().required(),
//       Joi.string().required(),
//       Joi.string()
//     )
//   });
// })
// .add('Joi#validate', function() {
//   Joi.validate({}, joiSchema, { abortEarly: true, convert: true });
// })
// .add('Ovt#validate', function() {
//   Ovt.validate({}, ovtSchema, { abortEarly: true, convert: true });
// })
// add listeners
.on('cycle', function(event) {
  console.log(String(event.target));
})
.on('complete', function() {
  console.log('Fastest is ' + this.filter('fastest').map('name'));
  // profiler.stopProfiling().export().pipe(fs.createWriteStream('/Users/fl/Desktop/ovt.cpuprofile'));
})
// run async
.run({ 'async': true });
